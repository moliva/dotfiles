#!/usr/bin/env bash

# current session name
session=$(tmux display-message -p '#S')

# list tmux sessions, trim names and remove active session names
list_sessions='reload:tmux list-sessions | sed -E "s/:.*$//" | grep -v \"^"$session"\$\"'

create_new_session='execute(tmux new-session -s {q} -d)+accept-or-print-query'
kill_session="execute(tmux kill-session -t {})+clear-query+$list_sessions"

tmux list-sessions | sed -E "s/:.*$//" | grep -v \"^"$session"\$\" | fzf \
  --reverse \
  --header 'Select session' \
  --header-first \
  --tmux center,40%,40% \
  --bind "start:$list_sessions" \
  --bind "ctrl-o:$create_new_session" \
  --bind "ctrl-x:$kill_session" |
  xargs tmux switch-client -t # switch to session
